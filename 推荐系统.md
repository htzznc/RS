# 推荐系统

## 目录

-   [CHAPTER 1 简介](#CHAPTER-1-简介)
    -   [评价：](#评价)
    -   [三种推荐](#三种推荐)
    -   [实验方法](#实验方法)
    -   [四个元素（重要性依次递增](#四个元素重要性依次递增)
    -   [评价指标](#评价指标)
-   [CHAPTER 2 利用用户行为](#CHAPTER-2-利用用户行为)
    -   [基于邻域的算法](#基于邻域的算法)
    -   [基于用户的协同过滤 UserCF](#基于用户的协同过滤-UserCF)
    -   [基于物品的协同过滤 ItemCF](#基于物品的协同过滤-ItemCF)
    -   [Swing算法](#Swing算法)
    -   [Surprise算法](#Surprise算法)
    -   [隐语义模型 （LFM](#隐语义模型-LFM)
    -   [矩阵补充](#矩阵补充)
-   [双塔模型（召回、后期融合物品特征和用户特征 计算量小](#双塔模型召回后期融合物品特征和用户特征-计算量小)
    -   [正负样本选择：](#正负样本选择)
    -   [双塔模型的改进](#双塔模型的改进)
    -   [Deep Retrieval召回（字节](#Deep-Retrieval召回字节)
-   [排序](#排序)
    -   [多目标模型(精排、前期融合](#多目标模型精排前期融合)
    -   [Multi-gate Mixture-of-Experts (MMoE)](#Multi-gate-Mixture-of-Experts-MMoE)
    -   [排序模型的特征：](#排序模型的特征)
        -   [特征处理：](#特征处理)
    -   [粗排：三塔模型（介于双塔和精排之间](#粗排三塔模型介于双塔和精排之间)
    -   [CHAPTER 3 内容推荐](#CHAPTER-3-内容推荐)
    -   [冷启动](#冷启动)
        -   [优化目标&评价指标](#优化目标评价指标)
        -   [召回](#召回)
        -   [流量调控](#流量调控)

![](image/image_BZotyK1Krw.png)

![](image/推荐系统数据服务架构图.drawio_IE9-ZdBtgC.png)

[一些tips](一些tips/一些tips.md "一些tips")

[用户、物品 画像](<用户、物品 画像/用户、物品 画像.md> "用户、物品 画像")

[一些基本知识](一些基本知识/一些基本知识.md "一些基本知识")

[神经网络](神经网络/神经网络.md "神经网络")

[模型精学](模型精学/模型精学.md "模型精学")

[数据集与任务](数据集与任务/数据集与任务.md "数据集与任务")

## CHAPTER 1 简介

### 评价：

用户，网站，内容提供方 三方共赢

拓宽视野而不仅仅是是准确推荐（只是方便了用户

### 三种推荐

-   个性化
-   搜索
-   上下文

### 实验方法

-   离线实验
-   用户调查
-   在线实验（AB测试） 对在前两种实验中表现好的模型/方法进行

### 四个元素（重要性依次递增

-   UI和UE
-   数据
-   领域知识
-   算法

### 评价指标

-   用户满意度 点击率，停留时间，转化率
-   预测准确度
-   覆盖率：对物品长尾的发掘能力（消除马太效应） 信息熵 、基尼指数
-   新颖性
-   惊喜度
-   信任度
-   实时性
-   健壮性
-   商业目标！

## CHAPTER 2 利用用户行为

### 基于邻域的算法

### 基于用户的协同过滤 UserCF

1.  找到与目标用户兴趣相似的用户集合
2.  找到这个集合中用户喜欢的，且目标用户没有听说过的物品推荐给目标用户

可用Jaccard相似度或者余弦相似度计算两个用户的兴趣相似度。

### 基于物品的协同过滤 ItemCF

### Swing算法

![](image/image_4_TkcGHLMM.png)

**u,v 是用户  i，j是产品   Ui是点击过产品i的用户集合     Iu是用户u点击过的产品集合**

为了衡量物品 i 和 j 的相似性，考察都购买了物品 i 和 j 的用户 u 和 v， 如果这两个用户共同购买的物品越少，则物品 i 和 j 的相似性越高。极端情况下，两个用户都购买了某个物品，且两个用户所有购买的物品中，共同购买的物品只有这两个，说明这两个用户兴趣差异非常大，然而却同时购买了这两个物品，则说明这两个物品相似性非常大！

### Surprise算法

引入时间，基于聚类，找到互补商品（类别，商品，聚类）

### 隐语义模型 （LFM

**学习“类”的参数   物品属于这个类的权重|用户对于这个类的兴趣**

### 矩阵补充

训练是为了得到用户id矩阵和物品id矩阵，使其满足用户对物品的兴趣预估。

![](image/image_vdWmwoyC7i.png)

把灰色块的预测值  作为对用户推荐的可能性

预测值=用户embedding向量·物品ID的embedding向量

缺点：

1.  仅用了ID embedding 没有利用物品、用户属性
2.  负样本选取方式不对：
    &#x20;样本： 用户-物品 二元组 （u，i)
    &#x20;正样本：曝光之后有点击交互  （没问题
    &#x20;负样本：曝光之后没有点击交互   （有问题 ×
3.  做训练的方法不好：
    &#x20; 内积  不如  余弦相似度
    &#x20; 平方损失  不如  交叉熵损失

## 双塔模型（召回、后期融合物品特征和用户特征 计算量小

![](image/image_TFsmDQ9Pwt.png)

![](image/image_OBJSN__r88.png)

#### 正负样本选择：

**正样本**：用户点击的物品    （用户-物品）二元组

问题：二八法则 少部分物品占据大部分点击

解决方案： 过采样冷门物品，降采样热门物品

**负样本**：

-   没有被召回的
-   召回但是被粗排，精排淘汰的
-   曝光但是未点击的

三种训练方法：

1.  pointwise 一个用户 一个物品（可正可负     二分类随机梯度下降

    鼓励cos(a,b) = 1(正样本) -1(负样本）
2.  pairwise  一个用户  一正一负  损失函数用   鼓励cos(a,b+) 大于 cos(a,b-）   如果cos(a,b+) 比 cos(a,b-)大了m那么多   那么就认为没有损失 否则损失就看下面这个公式

    **Triplet hinge loss**

    ![](image/image_L1iC3alPac.png)

    ![](image/image_O7P641OOao.png)
3.  listwise    一个用户  一正多负    损失函数用多元分类的瞬时函数

召回模型是特征后期融合（最后计算余弦相似度菜融合，排序模型是前期融合（输入神经网络前就融合

**自监督学习   物品塔  因为双塔模型的数据具有长尾效应  学不好低频率物品的特征向量表示**

特征变换      mask掉部分特征 &#x20;

**对物品做两种特征变换记作b' b''**

b'和b''应该有较高的相似度   &#x20;

方法：random mask、互补mask、dropout、mask一组关联的特征

【召回09：双塔模型+自监督学习】 [https://www.bilibili.com/video/BV1v24y1B7JH/?p=12\&share\_source=copy\_web\&vd\_source=d825324fd5f3862594874a76e14d8630](https://www.bilibili.com/video/BV1v24y1B7JH/?p=12\&share_source=copy_web\&vd_source=d825324fd5f3862594874a76e14d8630 "https://www.bilibili.com/video/BV1v24y1B7JH/?p=12\&share_source=copy_web\&vd_source=d825324fd5f3862594874a76e14d8630")

![](image/1698651203615_Sjv9a63B7o.png)

#### 双塔模型的改进

1.  优化正样本、负样本
2.  改进神经网络结构&#x20;
3.  改进模型的训练方法 &#x20;

### Deep Retrieval召回（字节

索引：路径→物品(召回时用）；物品→路径（训练时用） 一个物品对应多个路径  一个路径对应多个物品

![](image/image_LOfPF9BD6H.png)

![](image/image_h4zDdgoE1F.png)

Beam Search  实质就是贪心   需要设置超参数beam size

![](image/image_vIog7JahlB.png)

# 排序

-   曝光
-   点击    -    点击率
-   点赞    -    点赞率
-   收藏   -     收藏率
-   转发   -     转发率

排序依据👆

#### **多目标模型(** 精排、前期融合

-   用户特征

<!---->

-   物品特征

<!---->

-   统计特征

<!---->

-   场景特征

concatenation

神经网络（shared bottom) 多个共享  很复杂很大

全连接＋sigmoid

全连接＋sigmoid

全连接＋sigmoid

全连接＋sigmoid

-   点击率

<!---->

-   点赞率

<!---->

-   收藏率

<!---->

-   转发率

**训练****：** ​

**类别不平衡**：对负样本进行降采样

由于降采样负样本，所以预测的点击率等会偏高，所以需要做校准

#### Multi-gate Mixture-of-Experts (MMoE)

![](image/image_SLO-JgcZuA.png)

![](image/image_GUuJZwdzp3.png)

**极化现象：** p1，p2,p3 q1,q2,q3等权重之中其中一项趋近于1，其他项趋近于0.

可以用dropout解决。

Google 的论文\[1]提出MMOE 模型

·YouTube 的论文\[2] 提出极化问题的解决方案。

> \*参考文献 \*:

> *Jiaqi Ma et al. Modeling Task Relationships in Multi-task Learning withMulti-gate *[*Mixture-of-Experts.In*](http://Mixture-of-Experts.In "Mixture-of-Experts.In")* KDD 2018.2.*

> *Zhe Zhao et al. Recommending What Video to Watch Next: A MultitaskRanking *[*System.In*](http://System.In "System.In")* RecSys, 2019.*

### 排序模型的特征：

-   用户画像
-   物品画像
-   用户统计特征&#x20;
-   物品统计特征
-   场景特征 - 用户定位geohash、城市，当前时刻，是否周末节假日，手机品牌

#### 特征处理：

离散特征：做embedding

连续特征：分桶，将其变成离散特征

特征覆盖率

### 粗排：三塔模型（介于双塔和精排之间

![](image/image_d-Mu2mmgrf.png)

-   只有一个用户、只做一次推理
-   计算量不大

<!---->

-   有n个物品，理论上要做n次推理
-   可以缓存部分物品塔的输出向量，避免大部分推理

<!---->

-   实时变化、不能缓存
-   n个物品必须做n次推理

## CHAPTER 3 内容推荐

起步阶段   没有用户行为  别无选择

## 冷启动

### 优化目标&评价指标

提高作者积极性、激励发布

**目标**：

1.  精准推荐：把新笔记推给合适的用户，不引起用户反感
2.  激励发布
3.  挖掘高潜：找到高质量笔记，给予曝光倾斜

**评价指标**：

-   作者侧：发布渗透率、人均发布量
-   用户侧：新笔记的点击率、交互率    消费时长、日活、月活

大厂通用的

-   内容侧：高热笔记占比                                                                                                                                                                               少数在用

### 召回

-   **简单召回**
    改造双塔 - 将物品的embedding用别的embedding替代  比如学习一个同意的embedding  或者用相似笔记的embedding均值
    类目、关键词召回
-   **聚类召回**
    一篇新笔记发布后，用神经网络将它映射到一个特征向量，从1000个特征向量（对应1000个cluster（kmeans得到）中找到最相似的，作为新笔记的cluster，建立cluster→笔记ID（按照时间倒排）的索引，用用户的lastN行为召回cluster中的笔记。
    用多模态（CNN+BERT）的方法计算笔记的相似度
-   look-alike召回
    种子用户：满足条件的用户| 与新笔记有交互的用户
    look-alike用户：和种子用户相似的用户

### 流量调控

给新笔记保量   24小时内保证100次曝光 xxx

单独的召回通道

差异化保量

提权系数  增加新笔记的权重
